# =================================================================================
# Suricata Custom Rules for DNS Security Monitoring
# Author: Your Name/Organization
# Description: This file contains a curated list of Suricata rules for detecting
#              various threats and anomalies in DNS traffic, including DNS tunneling,
#              DGA (Domain Generation Algorithm) activity, typosquatting, and
#              unusual query patterns.
# =================================================================================

# --- 1. Detect Generic DNS Queries ---
# This rule logs every DNS query for basic monitoring and auditing purposes.
# It can generate a large amount of logs in a busy network.
alert dns any any -> any 53 (msg:"Generic DNS Query Detected"; dns_query; pcre:"."; sid:1000001; rev:1;)

# --- 2. Detect Possible DNS Tunneling ---
# This rule alerts on unusually long DNS queries, which is a common indicator of
# DNS tunneling, a technique for data exfiltration.
alert udp any any -> any 53 (msg:"Possible DNS Tunneling - Unusually long query"; dsize:>100; sid:1000002; rev:1;)

# --- 3. Detect DNS Queries to High Entropy/DGA Domains ---
# Identifies DNS queries for domains with high randomness, a pattern often
# used by malware and botnets for communication with Command & Control (C&C) servers.
alert dns any any -> any 53 (msg:"Suspicious DNS query - High entropy/DGA"; pcre:"/[a-z0-9]{20,}/i"; sid:1000003; rev:1;)

# --- 4. Detect Typosquatting / Look-alike Domain Queries ---
# This rule detects DNS queries for domains that are common misspellings or
# look-alikes of legitimate sites, often used in phishing attacks.
alert dns any any -> any 53 (msg:"Possible Typosquatting - goooogle.com"; dns_query; content:"|07|gooogle|03|com|00|"; nocase; sid:1000004; rev:1;)

# --- 5. Detect Queries for Rare DNS Record Types ---
# This rule flags queries for DNS record types that are not commonly used,
# which can sometimes be an indication of advanced attacks or data exfiltration attempts.
alert dns any any -> any 53 (msg:"Rare DNS record type query - SSHFP"; dns.query.type; content:"SSHFP"; sid:1000005; rev:1;)
alert dns any any -> any 53 (msg:"Rare DNS record type query - DNSKEY"; dns.query.type; content:"DNSKEY"; sid:1000006; rev:1;)

# --- 6. Detect Empty DNS Name Queries ---
# Flags DNS queries that have an empty name. This can be a sign of network
# reconnaissance or a misconfigured host.
alert dns any any -> any 53 (msg:"DNS query with empty name"; dns_query; content:"|00|"; sid:1000007; rev:1;)

# --- 7. Detect Queries for Crypto Mining Pools ---
# Identifies attempts to resolve domains associated with cryptocurrency mining,
# which can indicate a system is infected with cryptojacking malware.
alert dns any any -> any 53 (msg:"DNS query for a cryptomining pool"; dns_query; content:"minexmr"; sid:1000008; rev:1;)
